#!/bin/bash

# Directory to save Pokémon data
DATA_DIR="pokemon_data"
ERROR_FILE="errors.txt"

# List of Pokémon
POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Create directory and clear old logs
mkdir -p "$DATA_DIR"
> "$ERROR_FILE"

# Loop through Pokémon list
for pokemon in "${POKEMONS[@]}"; do
  echo "Fetching data for $pokemon..."

  success=false
  attempt=1

  while [ $attempt -le 3 ]; do
    # Fetch API data
    response=$(curl -s -w "%{http_code}" -o "${DATA_DIR}/${pokemon}.json" "https://pokeapi.co/api/v2/pokemon/${pokemon}")

    # Check status code
    if [ "$response" -eq 200 ]; then
      echo "Saved data to ${DATA_DIR}/${pokemon}.json ✅"
      success=true
      break
    else
      echo "Attempt $attempt for $pokemon failed (HTTP $response)"
      attempt=$((attempt + 1))
      sleep 2  # Wait before retry
    fi
  done

  # Log error if all retries failed
  if [ "$success" = false ]; then
    echo "❌ Failed to fetch data for $pokemon after 3 attempts." >> "$ERROR_FILE"
  fi

  echo ""
  sleep 1  # Delay to avoid rate limiting
done

echo "✅ Data fetching complete. Check $ERROR_FILE for any errors."
